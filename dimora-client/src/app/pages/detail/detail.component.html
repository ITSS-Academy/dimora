@if(isLoading$ | async) {
  <app-loading></app-loading>
} @else {
  @if(roomData$ | async; as room) {
    @if(currentUser$ | async; as currentUser) {
    @if(room?.id) {
    <div class="container">
      <div class="title">{{room.title}}</div>
    
      <!-- Gallery -->
            <div class="gallery">
       @for (image of room.images; track $index) {
         <img [src]="image" [alt]="'Room image ' + ($index + 1)" [class]="$index === 0 ? 'main' : ''">
       }
     </div>
    
    
      <!-- Wrapper chia 2 cá»™t -->
      <div class="content-wrapper">
        <div class="left-content">
          <!-- ThÃ´ng tin -->
          <div class="info">
            <p>{{room.max_guests}} khÃ¡ch Â· {{room.bedrooms}} phÃ²ng ngá»§ Â· {{room.beds}} giÆ°á»ng Â· {{room.bathrooms}} phÃ²ng táº¯m</p>
            <div class="price">GiÃ¡ Ä‘Ã£ bao gá»“m má»i khoáº£n phÃ­</div>
          </div>
    
          <!-- Host Section -->
          <div class="host-section">
            <div class="host-info">
              <img [src]="currentUser.avatar_url" alt="Host" class="host-avatar" referrerpolicy="no-referrer">
              <div>
                <p><strong>Host: {{currentUser.full_name}}</strong></p>
              </div>
            </div>
          </div>
    
          <!-- Section hiá»ƒn thá»‹ thÃªm -->
          <div class="about-section">
            <div class="more-info">
              <h3>Giá»›i thiá»‡u vá» chá»— á»Ÿ nÃ y</h3>
              <p>ChÃ o má»«ng báº¡n Ä‘áº¿n vá»›i P3.1 táº¡i Stardome Dalat â€“ nÆ¡i mang Ä‘áº¿n khÃ´ng gian tiá»‡n nghi, áº¥m cÃºng vÃ  táº§m nhÃ¬n tuyá»‡t Ä‘áº¹p hÆ°á»›ng rá»«ng thÃ´ng.</p>
              <p>âœ¨ Tiá»‡n Ã­ch ná»•i báº­t:<br>
                â€¢ Bá»“n táº¯m thÆ° giÃ£n vá»›i cá»­a kÃ­nh ngáº¯m cáº£nh ngay tá»« phÃ²ng táº¯m<br>
                â€¢ Báº¿p xinh xáº¯n ngoÃ i ban cÃ´ng<br>
                â€¢ Ban cÃ´ng rá»™ng rÃ£i view rá»«ng thÃ´ng cá»±c chill.<br>
                â€¢ BÃ£i Ä‘áº­u xe hÆ¡i miá»…n phÃ­<br>
                ğŸ‘‰ Náº¿u báº¡n cáº§n 2 giÆ°á»ng, vui lÃ²ng Ä‘áº·t tá»« 3 khÃ¡ch trá»Ÿ lÃªn Ä‘á»ƒ chÃºng tÃ´i chuáº©n bá»‹.
              </p>
              <h3>Chá»— á»Ÿ</h3>
              <p>Stardome Dalat lÃ  má»™t khÃ´ng gian lÆ°u trÃº cao cáº¥p náº±m trong khu phá»©c há»£p DALHA Complex â€“ tá»a láº¡c táº¡i vá»‹ trÃ­ Ä‘áº¯c Ä‘á»‹a, yÃªn tÄ©nh nhÆ°ng khÃ´ng xa trung tÃ¢m thÃ nh phá»‘. ChÃºng tÃ´i mang Ä‘áº¿n cho báº¡n nhá»¯ng cÄƒn há»™ cÃ³ thiáº¿t káº¿ hiá»‡n Ä‘áº¡i, Ä‘áº§y Ä‘á»§ tiá»‡n nghi, riÃªng tÆ° vÃ  chan hÃ²a cÃ¹ng thiÃªn nhiÃªn ÄÃ  Láº¡t.</p>
            </div>
          </div>

          <!-- Amenities Section -->
          <div class="amenities-section">
            <h3>What this place offers</h3>
            <div class="amenities-grid">
              @for (amenity of room.amenities; track amenity.id) {
                <div class="amenity-item">
                  <mat-icon class="material-symbols-rounded">{{amenity.icon_name }}</mat-icon>
                  <span class="amenity-name">{{ amenity.name }}</span>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Booking -->
        <div class="booking-container">
          <form [formGroup]="bookingForm" (ngSubmit)="onBookRoom()">
            <div class="price-section">
              <h2 *ngIf="totalNights > 0 && totalPrice > 0">{{ formatPrice(totalPrice) }} VNÄ</h2>
              <h2 *ngIf="totalNights === 0 && room.price_per_night">{{ formatPrice(room.price_per_night) }} VNÄ</h2>
              <p *ngIf="totalNights > 0">cho {{ totalNights }} Ä‘Ãªm</p>
              <p *ngIf="totalNights === 0">cho 1 Ä‘Ãªm</p>
            </div>
            <div class="date-section">
              <mat-form-field appearance="outline" class="date-field" (click)="picker.open()">
                <mat-date-range-input [rangePicker]="picker" [min]="minDate">
                  <input matStartDate formControlName="start" readonly placeholder="Start date">
                  <input matEndDate formControlName="end" readonly placeholder="End date">
                </mat-date-range-input>
                <mat-icon class="material-symbols-rounded" matSuffix>calendar_month</mat-icon>
                <mat-date-range-picker #picker></mat-date-range-picker>
              </mat-form-field>
            </div>
            
            <div class="guest-section">
              <mat-form-field appearance="outline" class="guest-field" [matMenuTriggerFor]="guestsMenu">
                <mat-label>Guests</mat-label>
                <input matInput formControlName="guests" readonly placeholder="Who">
                <mat-icon class="material-symbols-rounded" matSuffix>person</mat-icon>
              </mat-form-field>
              
              <mat-menu #guestsMenu="matMenu" class="guests-menu">
                <div class="guests-menu-content">
                  <div class="guest-row">
                    <div class="guest-info">
                      <div class="guest-label">Adults</div>
                      <div class="guest-subtitle">Ages 13 or above</div>
                    </div>
                    <div class="guest-controls">
                      <button mat-icon-button (click)="decreaseAdults($event)" [disabled]="adults <= 1">
                        <mat-icon class="material-symbols-rounded">remove</mat-icon>
                      </button>
                      <span class="guest-count">{{adults}}</span>
                      <button mat-icon-button (click)="increaseAdults($event)" [disabled]="(adults + children + infants) >= (room.max_guests || 0)">
                        <mat-icon class="material-symbols-rounded">add</mat-icon>
                      </button>
                    </div>
                  </div>
                  
                  <div class="guest-row">
                    <div class="guest-info">
                      <div class="guest-label">Children</div>
                      <div class="guest-subtitle">Ages 2-12</div>
                    </div>
                    <div class="guest-controls">
                      <button mat-icon-button (click)="decreaseChildren($event)" [disabled]="children <= 0">
                        <mat-icon class="material-symbols-rounded">remove</mat-icon>
                      </button>
                      <span class="guest-count">{{children}}</span>
                      <button mat-icon-button (click)="increaseChildren($event)" [disabled]="(adults + children + infants) >= (room.max_guests || 0)">
                        <mat-icon class="material-symbols-rounded">add</mat-icon>
                      </button>
                    </div>
                  </div>
                  
                  <div class="guest-row">
                    <div class="guest-info">
                      <div class="guest-label">Infants</div>
                      <div class="guest-subtitle">Under 2</div>
                    </div>
                    <div class="guest-controls">
                      <button mat-icon-button (click)="decreaseInfants($event)" [disabled]="infants <= 0">
                        <mat-icon class="material-symbols-rounded">remove</mat-icon>
                      </button>
                      <span class="guest-count">{{infants}}</span>
                      <button mat-icon-button (click)="increaseInfants($event)" [disabled]="(adults + children + infants) >= (room.max_guests || 0)">
                        <mat-icon class="material-symbols-rounded">add</mat-icon>
                      </button>
                    </div>
                  </div>
                  
                </div>
              </mat-menu>
            </div>
            <button mat-flat-button type="submit" class="book-button">Äáº·t phÃ²ng</button>
          </form>
      
        </div>
      </div>
    
    
    <!-- Modal hiá»ƒn thá»‹ thÃªm áº£nh -->
    
    <!-- Map Section -->
    <div class="map-section">
      <h3>Vá»‹ trÃ­</h3>
      <app-map 
        [latitude]="room.latitude" 
        [longitude]="room.longitude"
        [zoom]="15"
        >
      </app-map>
    </div>

    <div class="reviews">
      <!-- Review 1 -->
      <div class="review-item">
        <img src="https://png.pngtree.com/png-clipart/20210613/original/pngtree-dark-gray-simple-avatar-png-image_6404677.jpg" alt="avatar" class="avatar">
        <div class="review-content">
          <h4>Danh <span>Â· 9 thÃ¡ng hoáº¡t Ä‘á»™ng trÃªn Airbnb</span></h4>
          <div class="meta">â˜…â˜…â˜…â˜…â˜… Â· thÃ¡ng 4 nÄƒm 2025</div>
          <div class="text">
            Homestay ráº¥t sáº¡ch sáº½ vÃ  Ä‘Ãºng nhÆ° trong mÃ´ táº£, ngoÃ i ra anh chá»§ ráº¥t thÃ¢n thiá»‡n, luÃ´n há»— trá»£ nhiá»‡t tÃ¬nh vÃ  náº¿u sáºµn sÃ ng giÃºp Ä‘á»¡ má»i ngÆ°á»i trong táº§m tay. á» táº¡i homestay Ä‘Ã£ nÃ¢ng táº§m tráº£i...
          </div>
          <div class="more">Hiá»ƒn thá»‹ thÃªm</div>
        </div>
      </div>
    
      <!-- Review 2 -->
      <div class="review-item">
        <img src="https://png.pngtree.com/png-clipart/20210613/original/pngtree-dark-gray-simple-avatar-png-image_6404677.jpg" alt="avatar" class="avatar">
        <div class="review-content">
          <h4>Ngá»c Diem <span>Â· 5 nÄƒm hoáº¡t Ä‘á»™ng trÃªn Airbnb</span></h4>
          <div class="meta">â˜…â˜…â˜…â˜…â˜… Â· thÃ¡ng 6 nÄƒm 2025</div>
          <div class="text">
            PhÃ²ng gá»n gÃ ng sáº¡ch sáº½, gáº§n trung tÃ¢m nhÆ°ng yÃªn tÄ©nh, chá»§ nhÃ  há»— trá»£ ráº¥t nhiá»‡t tÃ¬nh. Náº¿u cÃ³ dá»‹p sáº½ quay láº¡i.
          </div>
          <div class="more">Hiá»ƒn thá»‹ thÃªm</div>
        </div>
      </div>
    
      <!-- Review 3 -->
      <div class="review-item">
        <img src="https://png.pngtree.com/png-clipart/20210613/original/pngtree-dark-gray-simple-avatar-png-image_6404677.jpg" alt="avatar" class="avatar">
        <div class="review-content">
          <h4>Imogen <span>Â· 9 nÄƒm hoáº¡t Ä‘á»™ng trÃªn Airbnb</span></h4>
          <div class="meta">â˜…â˜…â˜…â˜…â˜… Â· thÃ¡ng 7 nÄƒm 2025</div>
          <div class="text">
            Chá»— á»Ÿ cá»§a Vein khÃ´ng thá»ƒ hoÃ n háº£o hÆ¡n, chÃ­nh xÃ¡c nhÆ° mÃ´ táº£ vÃ  hÃ¬nh áº£nh, cÃ¡c cÄƒn há»™ ráº¥t Ä‘áº¹p vÃ  Ä‘Ãºng lÃ  nhá»¯ng gÃ¬ báº¡n cáº§n cho ká»³ nghá»‰ cá»§a mÃ¬nh á»Ÿ ÄÃ  Láº¡t...
          </div>
          <div class="more">Hiá»ƒn thá»‹ thÃªm</div>
        </div>
      </div>
    
      <!-- Review 4 -->
      <div class="review-item">
        <img src="https://png.pngtree.com/png-clipart/20210613/original/pngtree-dark-gray-simple-avatar-png-image_6404677.jpg" alt="avatar" class="avatar">
        <div class="review-content">
          <h4>Tráº§n <span>Â· 5 nÄƒm hoáº¡t Ä‘á»™ng trÃªn Airbnb</span></h4>
          <div class="meta">â˜…â˜…â˜…â˜…â˜… Â· thÃ¡ng 5 nÄƒm 2025</div>
          <div class="text">
            Home xinh, rá»™ng rÃ£i vá»«a Ä‘á»§. Chá»§ nhÃ  nhiá»‡t tÃ¬nh cÃ²n cho tá»¥i mÃ¬nh check in sá»›m. CÃ³ dá»‹p sáº½ quay láº¡i.
          </div>
        </div>
      </div>
    
      <!-- Review 5 -->
      <div class="review-item">
        <img src="https://png.pngtree.com/png-clipart/20210613/original/pngtree-dark-gray-simple-avatar-png-image_6404677.jpg" alt="avatar" class="avatar">
        <div class="review-content">
          <h4>Amber <span>Â· 2 nÄƒm hoáº¡t Ä‘á»™ng trÃªn Airbnb</span></h4>
          <div class="meta">â˜…â˜…â˜…â˜…â˜… Â· 1 tuáº§n trÆ°á»›c</div>
          <div class="text">
            Chá»— á»Ÿ giá»‘ng há»‡t nhÆ° trong áº£nh vÃ  lÃ  má»™t khÃ´ng gian Ä‘Ã¡ng yÃªu Ä‘á»ƒ thÆ° giÃ£n sau má»™t chiáº¿c xe buÃ½t qua Ä‘Ãªm. Viá»…n nhanh chÃ³ng tráº£ lá»i báº¥t ká»³ cÃ¢u há»i nÃ o cá»§a chÃºng tÃ´i vÃ  Ä‘á»ƒ chÃºng tÃ´i gá»­i...
          </div>
        </div>
      </div>
    
      <!-- Review 6 -->
      <div class="review-item">
        <img src="https://png.pngtree.com/png-clipart/20210613/original/pngtree-dark-gray-simple-avatar-png-image_6404677.jpg" alt="avatar" class="avatar">
        <div class="review-content">
          <h4>Hiáº¿u <span>Â· 2 tuáº§n trÆ°á»›c</span></h4>
          <div class="meta">â˜…â˜…â˜…â˜…â˜… Â· 2 tuáº§n trÆ°á»›c</div>
          <div class="text">
            Dá»… dá»a vá» tiá»n. Chá»— á»Ÿ sáº¡ch sáº½ vÃ  Ä‘Ã¡ng yÃªu. Chá»§ nhÃ  siÃªu thÃ´ng cáº£m vÃ  há»— trá»£, cho phÃ©p tÃ´i Ä‘á»ƒ láº¡i hÃ nh lÃ½...
          </div>
          <div class="more">Hiá»ƒn thá»‹ thÃªm</div>
        </div>
      </div>
    </div>
    <!-- Add Comment Section -->
    @if(mineProfile$ | async; as mineProfile) {
      @if(mineProfile.id) {

    <div class="add-comment">
      <div class="comment-box">
        <img src="https://png.pngtree.com/png-clipart/20210613/original/pngtree-dark-gray-simple-avatar-png-image_6404677.jpg" alt="avatar" class="avatar">
        <div class="input-area">
          <!-- Rating stars -->
          <!-- Textarea -->
          <mat-form-field appearance="outline" class="comment-textarea">
            <mat-label>Viáº¿t Ä‘Ã¡nh giÃ¡ cá»§a báº¡n...</mat-label>
            <textarea matInput rows="2" style="resize: none; overflow-y: auto;"></textarea>
            <button mat-icon-button matSuffix class="send-btn">
              <mat-icon>send</mat-icon>
            </button>
          </mat-form-field>
          <!-- <div class="rating">
            <input type="radio" id="star5" name="rating" value="5">
            <label for="star5" title="5 sao">â˜…</label>
            <input type="radio" id="star4" name="rating" value="4">
            <label for="star4" title="4 sao">â˜…</label>
            <input type="radio" id="star3" name="rating" value="3">
            <label for="star3" title="3 sao">â˜…</label>
            <input type="radio" id="star2" name="rating" value="2">
            <label for="star2" title="2 sao">â˜…</label>
            <input type="radio" id="star1" name="rating" value="1">
            <label for="star1" title="1 sao">â˜…</label>
          </div> -->
        </div>
      </div>
    </div>
  }
  }

    </div>
    } @else {
      <app-not-found></app-not-found>
    }
    } @else {
      <app-not-found></app-not-found>
    }
  } @else {
    <app-not-found></app-not-found>
  }
  
  
}