@if(isLoading$ | async) {
<app-loading></app-loading>
} @else { @if(roomData$ | async; as room) { @if(currentUser$ | async; as
currentUser) { @if(room?.id) {
<div class="container">
  <div class="title">{{ room.title }}</div>

  <!-- Gallery -->
  <div class="gallery">
    @for (image of room.images; track $index) {
    <img
      [src]="image"
      [alt]="'Room image ' + ($index + 1)"
      [class]="$index === 0 ? 'main' : ''"
    />
    }
  </div>

  <!-- Wrapper chia 2 c·ªôt -->
  <div class="content-wrapper">
    <div class="left-content">
      <!-- Th√¥ng tin -->
      <div class="info">
        <p>
          {{ room.max_guests }} kh√°ch ¬∑ {{ room.bedrooms }} ph√≤ng ng·ªß ¬∑
          {{ room.beds }} gi∆∞·ªùng ¬∑ {{ room.bathrooms }} ph√≤ng t·∫Øm
        </p>
        <div class="price">Gi√° ƒë√£ bao g·ªìm m·ªçi kho·∫£n ph√≠</div>
      </div>

      <!-- Host Section -->
      <div class="host-section">
        <div class="host-info">
          <img
            [src]="currentUser.avatar_url"
            alt="Host"
            class="host-avatar"
            referrerpolicy="no-referrer"
          />
          <div>
            <p>
              <strong>Host: {{ currentUser.full_name }}</strong>
            </p>
          </div>
        </div>
      </div>

      <!-- Section hi·ªÉn th·ªã th√™m -->
      <div class="about-section">
        <div class="more-info">
          <h3>Gi·ªõi thi·ªáu v·ªÅ ch·ªó ·ªü n√†y</h3>
          <p>
            Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi P3.1 t·∫°i Stardome Dalat ‚Äì n∆°i mang ƒë·∫øn kh√¥ng
            gian ti·ªán nghi, ·∫•m c√∫ng v√† t·∫ßm nh√¨n tuy·ªát ƒë·∫πp h∆∞·ªõng r·ª´ng th√¥ng.
          </p>
          <p>
            ‚ú® Ti·ªán √≠ch n·ªïi b·∫≠t:<br />
            ‚Ä¢ B·ªìn t·∫Øm th∆∞ gi√£n v·ªõi c·ª≠a k√≠nh ng·∫Øm c·∫£nh ngay t·ª´ ph√≤ng t·∫Øm<br />
            ‚Ä¢ B·∫øp xinh x·∫Øn ngo√†i ban c√¥ng<br />
            ‚Ä¢ Ban c√¥ng r·ªông r√£i view r·ª´ng th√¥ng c·ª±c chill.<br />
            ‚Ä¢ B√£i ƒë·∫≠u xe h∆°i mi·ªÖn ph√≠<br />
            üëâ N·∫øu b·∫°n c·∫ßn 2 gi∆∞·ªùng, vui l√≤ng ƒë·∫∑t t·ª´ 3 kh√°ch tr·ªü l√™n ƒë·ªÉ ch√∫ng
            t√¥i chu·∫©n b·ªã.
          </p>
          <h3>Ch·ªó ·ªü</h3>
          <p>
            Stardome Dalat l√† m·ªôt kh√¥ng gian l∆∞u tr√∫ cao c·∫•p n·∫±m trong khu ph·ª©c
            h·ª£p DALHA Complex ‚Äì t·ªça l·∫°c t·∫°i v·ªã tr√≠ ƒë·∫Øc ƒë·ªãa, y√™n tƒ©nh nh∆∞ng kh√¥ng
            xa trung t√¢m th√†nh ph·ªë. Ch√∫ng t√¥i mang ƒë·∫øn cho b·∫°n nh·ªØng cƒÉn h·ªô c√≥
            thi·∫øt k·∫ø hi·ªán ƒë·∫°i, ƒë·∫ßy ƒë·ªß ti·ªán nghi, ri√™ng t∆∞ v√† chan h√≤a c√πng thi√™n
            nhi√™n ƒê√† L·∫°t.
          </p>
        </div>
      </div>

      <!-- Amenities Section -->
      <div class="amenities-section">
        <h3>What this place offers</h3>
        <div class="amenities-grid">
          @for (amenity of room.amenities; track amenity.id) {
          <div class="amenity-item">
            <mat-icon class="material-symbols-rounded">{{
              amenity.icon_name
            }}</mat-icon>
            <span class="amenity-name">{{ amenity.name }}</span>
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Booking -->
    <div class="booking-container">
      <form [formGroup]="bookingForm" (ngSubmit)="onBookRoom()">
        <div class="price-section">
          <h2 *ngIf="totalNights > 0 && totalPrice > 0">
            {{ formatPrice(totalPrice) }} VNƒê
          </h2>
          <h2 *ngIf="totalNights === 0 && room.price_per_night">
            {{ formatPrice(room.price_per_night) }} VNƒê
          </h2>
          <p *ngIf="totalNights > 0">cho {{ totalNights }} ƒë√™m</p>
          <p *ngIf="totalNights === 0">cho 1 ƒë√™m</p>
        </div>
        <div class="date-section">
          <mat-form-field
            appearance="outline"
            class="date-field"
            (click)="picker.open()"
          >
            <mat-date-range-input [rangePicker]="picker" [min]="minDate">
              <input
                matStartDate
                formControlName="start"
                readonly
                placeholder="Start date"
              />
              <input
                matEndDate
                formControlName="end"
                readonly
                placeholder="End date"
              />
            </mat-date-range-input>
            <mat-icon class="material-symbols-rounded" matSuffix
              >calendar_month</mat-icon
            >
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
        </div>

        <div class="guest-section">
          <mat-form-field
            appearance="outline"
            class="guest-field"
            [matMenuTriggerFor]="guestsMenu"
          >
            <mat-label>Guests</mat-label>
            <input
              matInput
              formControlName="guests"
              readonly
              placeholder="Who"
            />
            <mat-icon class="material-symbols-rounded" matSuffix
              >person</mat-icon
            >
          </mat-form-field>

          <mat-menu #guestsMenu="matMenu" class="guests-menu">
            <div class="guests-menu-content">
              <div class="guest-row">
                <div class="guest-info">
                  <div class="guest-label">Adults</div>
                  <div class="guest-subtitle">Ages 13 or above</div>
                </div>
                <div class="guest-controls">
                  <button
                    mat-icon-button
                    (click)="decreaseAdults($event)"
                    [disabled]="adults <= 1"
                  >
                    <mat-icon class="material-symbols-rounded">remove</mat-icon>
                  </button>
                  <span class="guest-count">{{ adults }}</span>
                  <button
                    mat-icon-button
                    (click)="increaseAdults($event)"
                    [disabled]="
                      adults + children + infants >= (room.max_guests || 0)
                    "
                  >
                    <mat-icon class="material-symbols-rounded">add</mat-icon>
                  </button>
                </div>
              </div>

              <div class="guest-row">
                <div class="guest-info">
                  <div class="guest-label">Children</div>
                  <div class="guest-subtitle">Ages 2-12</div>
                </div>
                <div class="guest-controls">
                  <button
                    mat-icon-button
                    (click)="decreaseChildren($event)"
                    [disabled]="children <= 0"
                  >
                    <mat-icon class="material-symbols-rounded">remove</mat-icon>
                  </button>
                  <span class="guest-count">{{ children }}</span>
                  <button
                    mat-icon-button
                    (click)="increaseChildren($event)"
                    [disabled]="
                      adults + children + infants >= (room.max_guests || 0)
                    "
                  >
                    <mat-icon class="material-symbols-rounded">add</mat-icon>
                  </button>
                </div>
              </div>

              <div class="guest-row">
                <div class="guest-info">
                  <div class="guest-label">Infants</div>
                  <div class="guest-subtitle">Under 2</div>
                </div>
                <div class="guest-controls">
                  <button
                    mat-icon-button
                    (click)="decreaseInfants($event)"
                    [disabled]="infants <= 0"
                  >
                    <mat-icon class="material-symbols-rounded">remove</mat-icon>
                  </button>
                  <span class="guest-count">{{ infants }}</span>
                  <button
                    mat-icon-button
                    (click)="increaseInfants($event)"
                    [disabled]="
                      adults + children + infants >= (room.max_guests || 0)
                    "
                  >
                    <mat-icon class="material-symbols-rounded">add</mat-icon>
                  </button>
                </div>
              </div>
            </div>
          </mat-menu>
        </div>
        <button mat-flat-button type="submit" class="book-button">
          ƒê·∫∑t ph√≤ng
        </button>
      </form>
    </div>
  </div>

  <!-- Modal hi·ªÉn th·ªã th√™m ·∫£nh -->

  <!-- Map Section -->
  <div class="map-section">
    <h3>V·ªã tr√≠</h3>
    <app-map
      [latitude]="room.latitude"
      [longitude]="room.longitude"
      [zoom]="15"
    >
    </app-map>
  </div>

  <div class="reviews">
    <!-- Review 1 -->
    @for(item of reviewList$ | async; track item.id) {
    <div class="review-item">
      <img
        [src]="item.user_info?.avatar_url"
        alt="avatar"
        class="avatar"
        referrerpolicy="no-referrer"
      />
      <div class="review-content">
        <h4>{{ item.user_info?.full_name }}</h4>
        <span>{{ item.created_at | date : "short" }}</span>

        <div class="text">
          {{ item.comment }}
        </div>
      </div>
    </div>
    }
  </div>
  <!-- Add Comment Section -->
  @if(mineProfile$ | async; as mineProfile) { @if(mineProfile.id) {

  <div class="add-comment">
    <div class="comment-box">
      <img
        [src]="mineProfile.avatar_url"
        alt="avatar"
        class="avatar"
        referrerpolicy="no-referrer"
      />
      <form class="input-area" [formGroup]="profileReview">
        <!-- Rating stars -->
        <!-- Textarea -->
        <mat-form-field appearance="outline" class="comment-textarea">
          <mat-label>Vi·∫øt ƒë√°nh gi√° c·ªßa b·∫°n...</mat-label>
          <textarea
            type="text"
            matInput
            rows="2"
            style="resize: none; overflow-y: auto"
            formControlName="comment"
          ></textarea>
          <button
            mat-icon-button
            matSuffix
            class="send-btn"
            (click)="onCreateReview()"
          >
            <mat-icon>send</mat-icon>
          </button>
        </mat-form-field>
        <!-- <div class="rating">
            <input type="radio" id="star5" name="rating" value="5">
            <label for="star5" title="5 sao">‚òÖ</label>
            <input type="radio" id="star4" name="rating" value="4">
            <label for="star4" title="4 sao">‚òÖ</label>
            <input type="radio" id="star3" name="rating" value="3">
            <label for="star3" title="3 sao">‚òÖ</label>
            <input type="radio" id="star2" name="rating" value="2">
            <label for="star2" title="2 sao">‚òÖ</label>
            <input type="radio" id="star1" name="rating" value="1">
            <label for="star1" title="1 sao">‚òÖ</label>
          </div> -->
      </form>
    </div>
  </div>
  } }
</div>
} @else {
<app-not-found></app-not-found>
} } @else {
<app-not-found></app-not-found>
} } @else {
<app-not-found></app-not-found>
} }
